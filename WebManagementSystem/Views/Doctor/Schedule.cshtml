@{
    Layout = "_Layout";
}

<style>
    :root {
        --navy: #050816;
        --gold-light: #ffce70;
        --gradient-start: #8d79ff;
        --gradient-end: #ff9b61;
    }

    body {
        background: radial-gradient(circle at top left, #20254a, #050816 60%);
        color: white;
        font-family: 'Segoe UI', sans-serif;
        overflow-x: hidden;
    }

    /* Sidebar */
    .sidebar {
        width: 240px;
        height: 100vh;
        background: rgba(8,11,30,0.95);
        backdrop-filter: blur(18px);
        position: fixed;
        left: 0;
        top: 0;
        padding: 2rem 1.5rem;
        border-right: 1px solid rgba(255,255,255,0.08);
        display: flex;
        flex-direction: column;
        gap: 2.4rem;
    }

        .sidebar a {
            text-decoration: none;
            color: #c9cbe8;
            padding: .65rem .8rem;
            border-radius: 10px;
            transition: .2s;
            display: flex;
            align-items: center;
            gap: .7rem;
        }

            .sidebar a:hover,
            .sidebar a.active {
                background: rgba(255,255,255,.12);
                color: #fff;
            }

    .brand {
        font-size: 1.5rem;
        font-weight: 700;
        background: linear-gradient(90deg,var(--gradient-start),var(--gradient-end));
        -webkit-background-clip: text;
        color: transparent;
    }

    /* Page Wrapper */
    .page-wrapper {
        margin-left: 260px;
        padding: 2rem 2.4rem;
    }

    .page-title {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 2rem;
    }

    /* Search Section */
    .search-row {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.6rem;
    }

    .search-input, .filter-select {
        padding: 0.75rem 1rem;
        border-radius: 12px;
        background: rgba(4,7,20,0.9);
        border: 1px solid rgba(255,255,255,0.25);
        color: white;
        font-size: 0.95rem;
    }

    .search-input {
        flex: 1;
    }

    /* Glass Table */
    .glass-card {
        background: rgba(255,255,255,0.05);
        border: 1px solid rgba(255,255,255,0.14);
        border-radius: 20px;
        padding: 1.6rem;
        backdrop-filter: blur(14px);
        box-shadow: 0 18px 45px rgba(0,0,0,0.55);
    }

    table {
        width: 100%;
        border-collapse: collapse;
        color: white;
    }

    thead {
        background: rgba(255,255,255,0.08);
    }

    th, td {
        padding: 0.9rem;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .pill {
        padding: .32rem .7rem;
        border-radius: 999px;
        font-weight: 600;
        font-size: .78rem;
    }

    .pill-upcoming {
        background: #2980b9;
    }

    .pill-completed {
        background: #27ae60;
    }

    .pill-cancelled {
        background: #c0392b;
    }

    .btn-view {
        background: linear-gradient(110deg,#ffb84d,#ff9d3f);
        border: none;
        padding: .45rem 1rem;
        border-radius: 12px;
        color: #050816;
        font-weight: 700;
        text-decoration: none;
        transition: .12s;
    }

        .btn-view:hover {
            transform: translateY(-2px);
            filter: brightness(1.05);
        }
</style>

<!-- SIDEBAR -->
<div class="sidebar">
    <div class="brand">MedicaLux</div>

    <a asp-controller="Doctor" asp-action="Dashboard">🏠 Dashboard</a>
    <a class="active" asp-controller="Doctor" asp-action="Appointments">📅 Appointments</a>
    <a asp-controller="Doctor" asp-action="Patients">👤 Patients</a>
    <a asp-controller="Doctor" asp-action="LabRequests">🧪 Lab Requests</a>
    <a asp-controller="Doctor" asp-action="LabReports">📄 Lab Reports</a>
    <a asp-controller="Doctor" asp-action="Prescriptions">💊 Prescriptions</a>
    <a asp-controller="Doctor" asp-action="Billing">💳 Billing</a>
    <form asp-controller="Account" asp-action="Logout" method="post" class="d-inline">
        <button type="submit" style="background: none; border: none; color: #c9cbe8; padding: .7rem .8rem; border-radius: 10px; cursor: pointer; font-size: .95rem; width: 100%; text-align: left;">🚪 Logout</button>
    </form>
</div>

<!-- PAGE CONTENT -->
<div class="page-wrapper">

    <h1 class="page-title">📅 Appointments</h1>

    <!-- DATE SELECTOR -->
    <div class="search-row">
        <form method="get" asp-action="Schedule" style="display: flex; gap: 1rem; width: 100%;">
            <input type="date" name="date" value="@ViewBag.SelectedDate.ToString("yyyy-MM-dd")" 
                   class="search-input" style="flex: 0 0 250px;" onchange="this.form.submit()" />
            <button type="submit" class="btn-view" style="padding: 0.75rem 2rem;">Load Schedule</button>
        </form>
    </div>

    <!-- SCHEDULE TABLE -->
    <div class="glass-card">
        <h3 style="color: var(--gold-light); margin-bottom: 1.5rem;">
            Schedule for @ViewBag.SelectedDate.ToString("MMMM dd, yyyy")
        </h3>
        
        @if (ViewBag.Schedules != null && ((List<WebManagementSystem.Models.Schedule>)ViewBag.Schedules).Any())
        {
            <table>
                <thead>
                    <tr>
                        <th>Time Slot</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var schedule in (List<WebManagementSystem.Models.Schedule>)ViewBag.Schedules)
                    {
                        var hasAppointment = Context.RequestServices.GetService<WebManagementSystem.Models.HmsContext>()!
                            .Appointments.Any(a => a.ScheduleId == schedule.ScheduleId && a.Status != "Cancelled");
                        
                        <tr>
                            <td>Slot #@schedule.ScheduleId</td>
                            <td>@schedule.StartTime.ToString(@"hh\:mm tt")</td>
                            <td>@schedule.EndTime.ToString(@"hh\:mm tt")</td>
                            <td>
                                @if (hasAppointment)
                                {
                                    <span class="pill pill-upcoming">Booked</span>
                                }
                                else if (schedule.IsAvailable == true)
                                {
                                    <span class="pill pill-completed">Available</span>
                                }
                                else
                                {
                                    <span class="pill pill-cancelled">Unavailable</span>
                                }
                            </td>
                            <td>
                                @if (hasAppointment)
                                {
                                    var appointment = Context.RequestServices.GetService<WebManagementSystem.Models.HmsContext>()!
                                        .Appointments.FirstOrDefault(a => a.ScheduleId == schedule.ScheduleId && a.Status != "Cancelled");
                                    if (appointment != null)
                                    {
                                        <a asp-controller="Appointment" asp-action="Details" asp-route-id="@appointment.AppointmentId" class="btn-view">View Appointment</a>
                                    }
                                }
                                else
                                {
                                    <span style="color: #8f93a7;">—</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div style="text-align: center; padding: 3rem; color: #8f93a7;">
                <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">📅 No schedule slots for this date</p>
                <p>Schedule slots will be automatically created when patients book appointments for this date.</p>
            </div>
        }
    </div>

</div>
